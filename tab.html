<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- script src="./js/tab.js"> </script -->
    <script src="./js/MicrosoftTeams.min.js"> </script>
</head>

<body id="main">
    <h1>Yellow MS Team</h1>
</body>
<script>
    function getMeetingIHM(sessionCode) {
        window.location.href = "https://yellowintegration.azurewebsites.net/whiteboard/" + sessionCode + "/Guest";
        return '<div><h1>Chargement...</h1></div>';
    }

    function getSideIHM(sessionCode, userDisplayName) {
        return '<div><h1>Side Page</h1><input id="idChamp" value = "' + sessionCode + '"></input><input id="idUser" value = "' + userDisplayName + '"></input></div>';
    }

    function getDetailIHM(sessionCode) {
        //return '<div><h1>Meeting Detail</h1><input id="idChamp" value = "' + sessionCode + '"></input></div>';
        window.location.href = "https://yellowintegration.azurewebsites.net"
        return '<div><h1>Chargement...</h1></div>';
    }

    function setupPage(sessionCode, ctx, userDisplayName) {
        var str = "";
        switch (ctx) {
            //case "tab": str = getMeetingIHM(sessionCode); break;
            case "content": str = getDetailIHM(sessionCode);; break;
            case "sidePanel": str = getSideIHM(sessionCode, userDisplayName); break;
            case "meetingStage": str = getMeetingIHM(sessionCode); break;
            default: str = "<h1>Accès direct non autorisé...</h1>";
        }

        document.getElementById("main").innerHTML = str;
    }

    function initPage(ctx, userDisplayName) {
        // récupération du code de Session en paramètre
        var parameters = location.search.substring(1).split("&");
        var parameter = parameters[0].split("=");
        var sessionParam = parameter[0];
        var sessionCode = decodeURI(parameter[1]);

        setupPage(sessionCode, ctx, userDisplayName);
    }

    function getMSTeamsContext() {

        microsoftTeams.initialize();

        // Get the user context from Teams and set it in the state
        microsoftTeams.getContext((context, error) => {
            let userDisplayName = "None"
            alert(userDisplayName)

            //if (user === undefined) userDisplayName = "???"
            //else userDisplayName = user

            let ctx = context['frameContext'];
            initPage(ctx, userDisplayName)
        });
    }


    getMSTeamsContext()

</script>

</html>